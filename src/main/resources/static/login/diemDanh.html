<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý điểm danh & Báo cáo</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .hidden { display: none !important; } /* Force hidden */
    
    /* --- CSS GIAO DIỆN CHÍNH --- */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .class-name { color: green; cursor: pointer; font-weight: bold; text-decoration: underline; }
    .button {
        padding: 8px 16px; border: none; border-radius: 6px;
        background: #3EAEF4; color: white; cursor: pointer; margin-right: 5px;
    }
    .button:hover { background: #2a93d5; }
    .btn-report {
        background-color: #f0ad4e; color: white; padding: 5px 10px;
        border: none; border-radius: 4px; cursor: pointer;
    }
    .btn-report.has-data {
        background-color: #28a745; /* Màu xanh lá nếu đã có báo cáo */
    }
    input[type="text"], input[type="date"] { padding: 5px; margin-bottom: 10px; }

    /* --- CSS MODAL BÁO CÁO (GIỐNG HÌNH ẢNH) --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex; justify-content: center; align-items: center;
        z-index: 1000;
    }





























































































































































































































</body>
</html>
    function openClassDetail(index) {
        const cls = classes[index];
        editingIndex = index;
        document.getElementById("formTitle").innerText = "Chỉnh sửa điểm danh";
        document.getElementById("ngay").value = cls.ngay;
        document.getElementById("tenLop").value = cls.tenLop;
        document.getElementById("giaoVien").value = cls.giaoVien;
        
        toggleViews(false);
        loadStudentTable(cls.chiTiet);
    }
    
    function closeDetail() {
        toggleViews(true);
    }
</script>
    function renderClassList() {
        const tbody = document.getElementById("classList");
        tbody.innerHTML = "";
        classes.forEach((cls, index) => {
            const row = `
                <tr>
                    <td>${index + 1}</td>
                    <td>${cls.ngay}</td>
                    <td class="class-name" onclick="openClassDetail(${index})">${cls.tenLop}</td> 
                    <td>${cls.giaoVien}</td>
                    <td style="color:blue; font-weight:bold">${cls.diHoc}</td>
                    <td style="color:red; font-weight:bold">${cls.nghiHoc}</td>
                    <td>${cls.siSo}</td>
                </tr>
            `;
            tbody.insertAdjacentHTML("beforeend", row);
        });
    }
    function saveAttendance() {
        const ngay = document.getElementById("ngay").value;
        const tenLop = document.getElementById("tenLop").value.trim();
        const giaoVien = document.getElementById("giaoVien").value.trim();

        if (!ngay || !tenLop || !giaoVien) {
            alert("Vui lòng nhập đầy đủ thông tin!");
            return;
        }

        const tbody = document.getElementById("studentList");
        const rows = tbody.querySelectorAll("tr");
        let currentDetails = [];
        let countDiHoc = 0;
        let countNghi = 0;

        rows.forEach((row, i) => {
            const name = row.cells[1].innerText; 
            const diHoc = row.querySelector(".cb-dihoc").checked;
            const nghiPhep = row.querySelector(".cb-nghiphep").checked;
            // Lấy báo cáo từ biến tạm
            const reportContent = tempReports[i] || "";

            if (diHoc) countDiHoc++;
            else countNghi++;

            currentDetails.push({
                name: name,
                diHoc: diHoc,
                nghiPhep: nghiPhep,
                report: reportContent // Lưu báo cáo vào dữ liệu chính
            });
        });

        const classData = {
            ngay, tenLop, giaoVien,
            siSo: rows.length,
            diHoc: countDiHoc,
            nghiHoc: countNghi,
            chiTiet: currentDetails
        };

        if (editingIndex !== null) classes[editingIndex] = classData;
        else classes.push(classData);

        renderClassList();
        toggleViews(true);
    }
    // --- LƯU VÀ HIỂN THỊ DANH SÁCH LỚP ---
    function saveCurrentReport() {
        const content = document.getElementById("modalReportContent").value.trim();
        
        // Lưu vào biến tạm
        tempReports[currentReportStudentIndex] = content;

        // Đổi màu nút để báo hiệu đã có báo cáo
        const btn = document.getElementById(`btn-report-${currentReportStudentIndex}`);
        if(content) {
            btn.classList.add("has-data");
        } else {
            btn.classList.remove("has-data"); // Nếu xóa trống thì bỏ màu xanh
        }

        closeReportModal();
    }
    function closeReportModal() {
        document.getElementById("reportModal").classList.add("hidden");
    }
    function openReportModal(index, studentName) {
        currentReportStudentIndex = index;
        document.getElementById("modalStudentName").value = studentName;
        
        // Load nội dung cũ nếu có
        const oldContent = tempReports[index] || "";
        document.getElementById("modalReportContent").value = oldContent;

        document.getElementById("reportModal").classList.remove("hidden");
    }
    // --- XỬ LÝ MODAL BÁO CÁO ---
    function handleCheck(index, type) {
        const dihocCB = document.querySelector(`.cb-dihoc[index="${index}"]`);
        const nghiphepCB = document.querySelector(`.cb-nghiphep[index="${index}"]`);
        if (type === 'dihoc' && dihocCB.checked) nghiphepCB.checked = false;
        else if (type === 'nghiphep' && nghiphepCB.checked) dihocCB.checked = false;
    }
        listToRender.forEach((student, index) => {
            const diHocChecked = student.diHoc ? "checked" : "";
            const nghiPhepChecked = student.nghiPhep ? "checked" : "";
            
            // Kiểm tra xem có báo cáo chưa để đổi màu nút
            const hasReportClass = (tempReports[index] || student.report) ? "has-data" : "";

            const row = `
                <tr>
                    <td>${index + 1}</td>
                    <td style="text-align:left; padding-left:15px;">${student.name}</td>
                    <td><input type="checkbox" class="cb-dihoc" index="${index}" ${diHocChecked} onchange="handleCheck(${index}, 'dihoc')"></td>
                    <td><input type="checkbox" class="cb-nghiphep" index="${index}" ${nghiPhepChecked} onchange="handleCheck(${index}, 'nghiphep')"></td>
                    <td>
                        <button id="btn-report-${index}" class="btn-report ${hasReportClass}" onclick="openReportModal(${index}, '${student.name}')">Báo cáo</button>
                    </td>
                </tr>
            `;
            tbody.insertAdjacentHTML("beforeend", row);
        });
    }
        // Nếu đang sửa (studentDetails tồn tại), ta cần đổ dữ liệu report vào biến tạm tempReports
        if(studentDetails) {
            tempReports = {};
            studentDetails.forEach((st, idx) => {
                if(st.report) tempReports[idx] = st.report;
            });
        }
        // Nếu đang sửa, lấy dữ liệu từ studentDetails, nếu mới thì lấy từ sampleStudents
        const listToRender = studentDetails ? studentDetails : sampleStudents.map(name => ({
            name: name, diHoc: false, nghiPhep: false, report: ""
        }));        tbody.innerHTML = "";        const tbody = document.getElementById("studentList");
    function loadStudentTable(studentDetails = null) {
    // --- XỬ LÝ BẢNG HỌC VIÊN ---        if (showList) {
            document.getElementById("tableView").classList.remove("hidden");
            document.getElementById("detailView").classList.add("hidden");
        } else {
            document.getElementById("tableView").classList.add("hidden");
            document.getElementById("detailView").classList.remove("hidden");
        }
    }
    function toggleViews(showList) {    }        loadStudentTable();         toggleViews(false);        
        tempReports = {}; // Reset báo cáo tạm        document.getElementById("giaoVien").value = "";        document.getElementById("tenLop").value = "Lớp Tiếng Anh";        document.getElementById("ngay").valueAsDate = new Date();        document.getElementById("formTitle").innerText = "Thêm điểm danh mới";        editingIndex = null;
    function openAddAttendance() {
    // --- CÁC HÀM ĐIỀU HƯỚNG ---    let currentReportStudentIndex = null; // Đang báo cáo cho học sinh nào    let tempReports = {};     // Key là index của học sinh, Value là nội dung báo cáo
    // Biến tạm lưu trữ báo cáo khi đang thao tác (trước khi bấm Lưu ở màn hình chính)    ];        "Nguyễn Hải Yến", "Phùng Phương Anh"        "Lê Nguyễn Bảo Lâm", "Đào Đức Minh", "Nguyễn Trung Hiếu",        "Ngô Đức Bảo", "Hoàng Uyên Phương", "Đinh Thảo My",    const sampleStudents = [    let editingIndex = null;     let classes = [];     // Dữ liệu
<script></div>    </div>        <div class="report-footer"></div>
        <!-- Footer trang trí -->        </div>            </div>                <textarea id="modalReportContent" class="comment-textarea"></textarea>                <div class="comment-header">NHẬN XÉT</div>
            <div class="comment-section">            </div>                <input type="text" id="modalStudentName" class="student-input" readonly>                <label>HỌC VIÊN :</label>            <div class="student-row">        <div class="report-body">
        <!-- Body -->        </div>            <button class="btn-save-report" onclick="saveCurrentReport()">LƯU</button>            Báo cáo            <button class="btn-close-modal" onclick="closeReportModal()">&#10005;</button>        <div class="report-header">        <!-- Header -->    <div class="report-box"><div id="reportModal" class="modal-overlay hidden"><!-- Giao diện 3: MODAL BÁO CÁO (Popup) --></div>    <button class="button" onclick="closeDetail()" style="background: #ccc; color: #333;">Quay lại</button>    <button class="button" onclick="saveAttendance()">Lưu thông tin lớp học</button>
    <br>    </table>        <tbody id="studentList"></tbody>        </thead>            </tr>                <th>Thao tác</th>                <th>Nghỉ phép</th>                <th>Đi học</th>                <th>Học viên</th>                <th>STT</th>            <tr>        <thead>    <table id="studentTable">
    <h4>Danh sách học viên</h4>    <label style="margin-left: 20px">Giáo viên: </label><input type="text" id="giaoVien">    <label style="margin-left: 20px">Tên lớp: </label><input type="text" id="tenLop">    <label>Ngày học: </label><input type="date" id="ngay">
    <h4>Thông tin chung</h4>    <h2 id="formTitle">Thực hiện điểm danh</h2><div id="detailView" class="hidden"><!-- Giao diện 2: Form điểm danh chi tiết --></div>    </table>        <tbody id="classList"></tbody>        </thead>            </tr>                <th>Sĩ số</th>                <th>Nghỉ</th>                <th>Đi học</th>                <th>Giáo viên</th>                <th>Tên lớp</th>                <th>Ngày học</th>                <th>STT</th>            <tr>        <thead>
    <table id="attendanceTable">    <button class="button" onclick="openAddAttendance()">Thêm điểm danh mới</button>    <h2>Danh sách các buổi điểm danh</h2><div id="tableView"><!-- Giao diện 1: Danh sách các buổi điểm danh --><body></head></style>    }        width: 100%;        background-color: #166ba6;        height: 40px;    .report-footer {    /* Footer xanh đậm dưới cùng */    }        outline: none;        font-size: 14px;        font-family: Arial, sans-serif;        resize: none;        box-sizing: border-box;        padding: 10px;        border: none;        height: 200px;        width: 100%;    .comment-textarea {    }        text-transform: uppercase;        font-weight: bold;        text-align: center;        padding: 10px;        color: white;        background-color: #166ba6; /* Màu xanh đậm tiêu đề Nhận xét */    .comment-header {    }        background: white;        overflow: hidden;        border-radius: 5px;        border: 1px solid #166ba6;    .comment-section {    /* Khung nhận xét */    }        font-weight: bold;        background: white;        font-size: 16px;        border: 1px solid #ccc;        border-radius: 4px;        padding: 10px;        flex: 1;    .student-input {    }        color: black;        text-transform: uppercase;        font-weight: bold;        width: 120px;    .student-row label {    }        margin-bottom: 20px;        align-items: center;        display: flex;    .student-row {    }        padding: 20px;    .report-body {    /* Body của Modal */    }        background: none; border: none; color: white; font-size: 20px; cursor: pointer;        position: absolute; left: 15px; top: 15px;    .btn-close-modal {    /* Nút đóng (X) để thoát nếu không muốn lưu */        .btn-save-report:hover { background-color: #0f5385; }    }        text-transform: uppercase;        cursor: pointer;        font-weight: bold;        border-radius: 4px;        padding: 8px 20px;        border: none;        color: white;        background-color: #166ba6; /* Màu xanh đậm nút Lưu */        top: 15px;        right: 15px;        position: absolute;    .btn-save-report {    }        font-weight: bold;        font-size: 24px;        color: white;        padding: 15px;        text-align: center;        position: relative;    .report-header {    /* Header của Modal */    }        position: relative;        font-family: Arial, sans-serif;        overflow: hidden;        box-shadow: 0 4px 10px rgba(0,0,0,0.3);        border-radius: 4px;        background-color: #63cafa; /* Màu nền xanh sáng */        width: 600px;    .report-box {